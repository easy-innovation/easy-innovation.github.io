"use strict";(self.webpackChunkpages=self.webpackChunkpages||[]).push([[921],{130:(A,D,r)=>{r.d(D,{J:()=>s});var i=r(7602),l=r(2998),y=r(2881),f=r(870),m=r(2615);let s=(()=>{var O;class I{constructor(n,t){this.globalsService=n,this.uploadEndpointsService=t,this.cache={},this.userStorage={},this.fileLimits={},this.widgetFolders={},this.profileSubscription=this.globalsService.profileObservable.subscribe(a=>{this.profileFfuid=a?.user.ffuid})}get ffuid(){return this.profileFfuid}getWidgetFolders(n){const t=this.createKey(n);return this.widgetFolders[t]}setWidgetFolders(n,t){this.widgetFolders[this.createKey(n)]=t}getFileLimits(){const n=this.createKey();return this.fileLimits[n]}setFileLimits(n){if(!this.ffuid)return;const t=this.createKey();this.fileLimits[t]=n}getUserStorage(){const n=this.createKey();return this.userStorage[n]}setUserStorage(n){if(!this.ffuid)return;const t=this.createKey();this.userStorage[t]=n}deleteUserStorage(){if(this.ffuid){const n=this.createKey();delete this.userStorage[n]}}getItem(n){const t=this.createKey(n);if((0,l.l$)(this.cache,t))return this.cache[t]}setItem(n,t){this.cache[this.createKey(n)]=t}removeItem(n){const t=this.createKey(n);if((0,l.l$)(this.cache,t)){if(this.cache[t].folders.length)for(const a of this.cache[t].folders)this.removeItem([...n,a.name]);return delete this.cache[t],!0}return!1}getEntities(n,t){const a={},p=this.createKey(n);if(!(0,l.l$)(this.cache,p))return a;for(const L of t){const T=(L.type===i.OE.FILE?this.cache[p].files:this.cache[p].folders).find(c=>c.name===L.name);T&&(a[T.name]=T)}return a}addEntities(n,t,a=i.OE.FILE){const p=this.createKey(n);return!!(0,l.l$)(this.cache,p)&&(Array.isArray(t)||(t=[t]),a===i.OE.FILE?this.cache[p].files.unshift(...t):this.cache[p].folders.unshift(...t),!0)}removeEntities(n,t,a=i.OE.FILE){if(Array.isArray(t)||(t=[t]),a===i.OE.FOLDER)for(const c of t)this.removeItem([...n,c]);const p=this.createKey(n);if(!(0,l.l$)(this.cache,p))return[];const L=a===i.OE.FILE?"files":"folders",T=[];for(const c of t){const v=this.cache[p][L].findIndex(o=>o.name===c);v>-1&&(this.cache[p][L].splice(v,1),T.push(c))}return T}refactorFolderContent(n,t){const a=this.createKey(n);if(!(0,l.l$)(this.cache,a))return!1;t.endsWith("/")||(t+="/");for(const p of this.cache[a].folders)p.url=t+p.name;for(const p of this.cache[a].files)p.url=p.embedUrl=t+p.name,p.time=Date.now();return!0}createKey(n=[]){return`${this.ffuid}/${this.uploadEndpointsService.requiredActiveRemote.id}/${n.join("/")}`}ngOnDestroy(){this.profileSubscription.unsubscribe()}static#e=O=()=>(this.\u0275fac=function(t){return new(t||I)(m.KVO(y.k),m.KVO(f.D))},this.\u0275prov=m.jDH({token:I,factory:I.\u0275fac,providedIn:"root"}))}return O(),I})()},870:(A,D,r)=>{r.d(D,{D:()=>a});var i=r(467),l=r(2615),y=r(9295),f=r(2998),m=r(959),s=r(1946),O=r(1806),I=r(2881),e=r(7696),n=r(9018),t=r(7184);let a=(()=>{var p;class L{constructor(){this.graphqlService=(0,l.WQX)(f.Pp),this.uploadPreferencesService=(0,l.WQX)(s.d),this.uploadObservablesService=(0,l.WQX)(O.f),this.globalsService=(0,l.WQX)(I.k),this.uploadTokensService=(0,l.WQX)(n.h),this.defaultRemoteId="default",this.activeRemoteIdSignal=(0,l.vPA)(this.uploadPreferencesService.remote?.id||this.defaultRemoteId),this.remotesListSignal=(0,l.vPA)({[e.j.OWNED]:[],[e.j.LINKED]:[]}),this.isRemoteAdviceEnabledSignal=(0,l.vPA)(!(this.uploadPreferencesService.remote?.advice?.disabled&&Date.now()-this.uploadPreferencesService.remote.advice.disabledAt<2592e6)),this.profileFFUid=this.globalsService.credentials?.user.ffuid,this.remotesCache={},this.canChangeActiveRemote=!0,this.activeRemoteId=this.activeRemoteIdSignal.asReadonly(),this.remotesList=this.remotesListSignal.asReadonly(),this.isRemoteAdviceEnabled=this.isRemoteAdviceEnabledSignal.asReadonly(),this.activeRemote=(0,y.EW)(()=>{const c=this.activeRemoteIdSignal();return this.remotesListSignal().linked.find(o=>o.id===c&&!o.deleted)}),this.lastListSelected=void 0}get requiredActiveRemote(){const c=this.activeRemote();if(!c)throw new Error("UploadRemoteNotAvailableError");return c}disableActiveRemoteChange(){this.canChangeActiveRemote=!1}enableActiveRemoteChange(){this.canChangeActiveRemote=!0}disableRemoteAdvice(c=!1){this.isRemoteAdviceEnabledSignal.set(!1),c&&(this.uploadPreferencesService.remote={id:this.activeRemoteId(),advice:{disabled:!0,disabledAt:Date.now()}})}setActiveRemote(c){!this.canChangeActiveRemote||this.activeRemoteId()===c||(this.uploadPreferencesService.remoteId=c,this.activeRemoteIdSignal.set(c),this.uploadObservablesService.pushActiveRemote(this.activeRemote()))}resetActiveRemote(){this.setActiveRemote(this.defaultRemoteId)}canRemoteBeSelected(c){return this.remotesList().linked.findIndex(v=>v.id===c&&!v.deleted)>-1}setRemoteList(c,v){var o=this;return(0,i.A)(function*(){const _=o.getRemotesCache();let g;if(_&&!v?.remoteInfoId)o.remotesListSignal.set({[e.j.OWNED]:[..._.owned],[e.j.LINKED]:[..._.defaults,..._.others]});else{const S=t.P([{operation:"uploadRemoteLinked",fields:m.rJ},{operation:"uploadRemoteList",fields:m.rJ},...v?.remoteInfoId?[{operation:"uploadRemoteInfo",fields:m.rJ,variables:{remoteInfoId:{name:"id",type:"String",required:!0,value:v.remoteInfoId}}}]:[],...v?.sizeToken?[{operation:"uploadEntitiesSizeToken",variables:{...v.sizeToken.allowCompute?{allowCompute:{type:"Boolean",value:v.sizeToken.allowCompute}}:{}}}]:[],...v?.listToken?[{operation:"uploadEntitiesListToken",variables:{target:{type:"String",required:!0,value:v.listToken.paths.join("/")}}}]:[]]),R=(yield o.graphqlService.query({query:S.query,variables:S.variables})).data,P=[],u=[],d=R.uploadRemoteList.map(h=>({...h,default:o.isDefaultRemote(h.id)}));for(const h of R.uploadRemoteLinked){const E={...h,default:o.isDefaultRemote(h.id)};E.default?P.push(E):u.push(E)}o.remotesListSignal.set({[e.j.OWNED]:[...d.sort((h,E)=>h.name.localeCompare(E.name))],[e.j.LINKED]:[...P.sort((h,E)=>h.id.localeCompare(E.id)),...u.sort((h,E)=>h.name.localeCompare(E.name))]}),o.setRemotesCache({defaults:P,owned:d,others:u}),R.uploadEntitiesListToken&&(o.uploadTokensService.fileListToken=R.uploadEntitiesListToken),R.uploadEntitiesSizeToken&&(o.uploadTokensService.userStorageToken=R.uploadEntitiesSizeToken),R.uploadRemoteInfo&&(g={...R.uploadRemoteInfo,default:o.isDefaultRemote(R.uploadRemoteInfo.id)})}if(c&&o.activeRemoteId()!==c){if(o.canRemoteBeSelected(c))return o.setActiveRemote(c),o.uploadTokensService.fileListToken=void 0,{activeRemoteChangedId:c,remoteInfoResult:g};o.uploadObservablesService.pushRemoteForm(c)}return o.activeRemote()?{remoteInfoResult:g}:(o.resetActiveRemote(),{activeRemoteChangedId:o.defaultRemoteId,remoteInfoResult:g})})()}refreshRemoteList(){var c=this;return(0,i.A)(function*(){c.deleteRemotesCache(),yield c.setRemoteList()})()}upsertRemote(c,v,o,_){var g=this;return(0,i.A)(function*(){const S=(yield g.graphqlService.mutate({mutation:m.uZ,variables:{id:_,address:v,name:c,email:o}})).data?.uploadRemoteUpsert;if(S)return yield g.refreshRemoteList(),S})()}linkRemote(c){var v=this;return(0,i.A)(function*(){const o=(yield v.graphqlService.mutate({mutation:m.dK,variables:{id:c}})).data?.uploadRemoteLink;return c===o&&(yield v.refreshRemoteList(),!0)})()}deleteRemote(c){var v=this;return(0,i.A)(function*(){return v.deleteUnlinkRemote(c,v.remotesList().owned,(0,i.A)(function*(){return(yield v.graphqlService.mutate({mutation:m.eF,variables:{id:c}})).data.uploadRemoteDelete}))})()}unlinkRemote(c){var v=this;return(0,i.A)(function*(){return v.deleteUnlinkRemote(c,v.remotesList().linked,(0,i.A)(function*(){return(yield v.graphqlService.mutate({mutation:m.OD,variables:{id:c}})).data.uploadRemoteUnlink}))})()}deleteUnlinkRemote(c,v,o){var _=this;return(0,i.A)(function*(){return!(-1===v.findIndex(R=>R.id===c)||!(yield o())||(c===_.activeRemoteId()&&_.setActiveRemote(_.defaultRemoteId),yield _.refreshRemoteList(),0))})()}getRemotesCache(){return this.profileFFUid?this.remotesCache[this.profileFFUid]:void 0}setRemotesCache(c){this.profileFFUid&&(this.remotesCache[this.profileFFUid]=c)}deleteRemotesCache(){this.profileFFUid&&delete this.remotesCache[this.profileFFUid]}isDefaultRemote(c){return c.startsWith(this.defaultRemoteId)}static#e=p=()=>(this.\u0275fac=function(v){return new(v||L)},this.\u0275prov=l.jDH({token:L,factory:L.\u0275fac,providedIn:"root"}))}return p(),L})()},959:(A,D,r)=>{r.d(D,{BC:()=>y,CZ:()=>L,F8:()=>f,Ny:()=>O,OD:()=>t,TE:()=>m,YW:()=>s,_9:()=>I,_Y:()=>l,dK:()=>a,eF:()=>n,rJ:()=>e,uZ:()=>p,yf:()=>i});const i="\nquery UploadEntitiesListToken($target: String!) {\n    uploadEntitiesListToken(target: $target)\n}",l="\nquery UploadEntitiesHostToken($target: String!, $allowReplace: Boolean) {\n    uploadEntitiesHostToken(target: $target, allowReplace: $allowReplace)\n}",y="\nquery UploadEntitiesCreateDirectoryToken($target: String!) {\n    uploadEntitiesCreateDirectoryToken(target: $target)\n}",f="\nquery UploadEntitiesMoveToken($source: String!, $target: String!) {\n    uploadEntitiesMoveToken(source: $source, target: $target)\n}",m="\nquery UploadEntitiesDeleteToken($target: String!) {\n    uploadEntitiesDeleteToken(target: $target)\n}",s="\nquery UploadHistoryAvailableDateRange {\n    uploadHistoryAvailableDateRange {\n        start\n        end\n    }\n}",O="\nquery UploadEntitiesSizeToken($allowCompute: Boolean) {\n    uploadEntitiesSizeToken(allowCompute: $allowCompute)\n}",I="\nquery UploadEntitiesLimitsToken {\n    uploadEntitiesLimitsToken\n}",e=["id","owner","email","name","address","lastUpdate","deleted"],n="\nmutation UploadRemoteDelete($id: String!) {\n    uploadRemoteDelete(id: $id)\n}",t="\nmutation UploadRemoteUnlink($id: String!) {\n    uploadRemoteUnlink(id: $id)\n}",a="\nmutation UploadRemoteLink($id: String!) {\n    uploadRemoteLink(id: $id)\n}",p="\nmutation UploadRemoteUpsert($email: String!, $name: String!, $address: String!, $id: String) {\n    uploadRemoteUpsert(email: $email, name: $name, address: $address, id: $id)\n}",L="\nsubscription UploadEntities {\n    uploadEntities {\n        eventMessage\n        eventType\n        user {\n            avatar\n            host\n            id\n            nickname\n        }\n    }\n}"},1621:(A,D,r)=>{r.d(D,{P:()=>f});var i=r(2200),l=r(2615),y=r(3664);let f=(()=>{var m;class s{static#e=m=()=>(this.\u0275fac=function(e){return new(e||s)},this.\u0275mod=y.$C({type:s}),this.\u0275inj=l.G2t({imports:[i.MD]}))}return m(),s})()},1806:(A,D,r)=>{r.d(D,{f:()=>m});var i=r(1413),l=r(4412),y=r(1946),f=r(2615);let m=(()=>{var s;class O{constructor(e){this.uploadPreferencesService=e,this.selectedFileListArray=[],this.actionSubject=new i.B,this.uploadingFileQueueSubject=new i.B,this.uploadingFileErrorSubject=new i.B,this.currentFolderPathSubject=new i.B,this.layoutOptionsSubject=new i.B,this.renameEntitySubject=new i.B,this.entityPendingSubject=new i.B,this.deleteFileSubject=new i.B,this.uploadedFileSubject=new i.B,this.draggedFileListSubject=new i.B,this.startUploadSubject=new i.B,this.startMoveSubject=new i.B,this.activeRemoteIdSubject=new i.B,this.remoteFormSubject=new i.B,this.selectedFileListSubject=new l.t(this.selectedFileListArray)}get actionObservable(){return this.actionSubject.asObservable()}pushAction(e){this.actionSubject.next(e)}get layoutOptionsObservable(){return this.layoutOptionsSubject.asObservable()}pushLayoutOptions(e){this.uploadPreferencesService.layoutOptions=e,this.layoutOptionsSubject.next(e)}get currentFolderPathObservable(){return this.currentFolderPathSubject.asObservable()}pushCurrentFolderPath(e){this.uploadPreferencesService.lastFolderPath=e,this.currentFolderPathSubject.next(e)}get uploadingFileQueueObservable(){return this.uploadingFileQueueSubject.asObservable()}pushUploadingFileQueue(e){this.uploadingFileQueueSubject.next(e)}get uploadingFileErrorObservable(){return this.uploadingFileErrorSubject.asObservable()}pushUploadingFileError(e){this.uploadingFileErrorSubject.next(e)}get renameEntityObservable(){return this.renameEntitySubject.asObservable()}pushRenameEntity(e){this.renameEntitySubject.next(e)}get entityPendingObservable(){return this.entityPendingSubject.asObservable()}pushEntityPending(e){this.entityPendingSubject.next(e)}get deleteFileObservable(){return this.deleteFileSubject.asObservable()}pushDeleteFile(e){this.deleteFileSubject.next(e)}get uploadedFileObservable(){return this.uploadedFileSubject.asObservable()}pushUploadedFile(e){this.uploadedFileSubject.next(e)}get draggedFileListObservable(){return this.draggedFileListSubject.asObservable()}pushDraggedFileList(e){this.draggedFileListSubject.next(e)}get startUploadObservable(){return this.startUploadSubject.asObservable()}pushStartUpload(e){this.startUploadSubject.next(e)}get startMoveObservable(){return this.startMoveSubject.asObservable()}pushStartMove(e){this.startMoveSubject.next(e)}get selectedFileListObservable(){return this.selectedFileListSubject.asObservable()}pushSelectedFile(e){if(Array.isArray(e)||(e=[e]),0===e.length)return void(this.selectedFileListArray.length>0&&(this.selectedFileListArray=[],this.selectedFileListSubject.next(this.selectedFileListArray)));let n=!1;for(const t of e){const a=this.selectedFileListArray.findIndex(p=>p.name===t.name);t.selected?-1===a&&(this.selectedFileListArray.push({name:t.name}),n=!0):a>-1&&(this.selectedFileListArray.splice(a,1),n=!0)}n&&this.selectedFileListSubject.next(this.selectedFileListArray)}get activeRemoteObservable(){return this.activeRemoteIdSubject.asObservable()}pushActiveRemote(e){this.activeRemoteIdSubject.next(e)}get remoteFormObservable(){return this.remoteFormSubject.asObservable()}pushRemoteForm(e){this.remoteFormSubject.next(e)}static#e=s=()=>(this.\u0275fac=function(n){return new(n||O)(f.KVO(y.d))},this.\u0275prov=f.jDH({token:O,factory:O.\u0275fac,providedIn:"root"}))}return s(),O})()},1946:(A,D,r)=>{r.d(D,{d:()=>O});var i=r(2998),l=r(6350),y=r(3345),f=r(4857),m=r(1729),s=r(2615);let O=(()=>{var I;class e{constructor(t,a){this.preferencesService=t,this.urlQueryParamsService=a;const p=this.urlQueryParamsService.getAndDeleteParam(l.FQ.UPLOAD_PATH);p&&(this.lastFolderPath=p.split("/").filter(L=>L.length>0))}get preferences(){return this.preferencesService.getItem(l.Xn.UPLOAD)||f.dy}set preferences(t){this.preferencesService.setItem(l.Xn.UPLOAD,t)}get lastFolderPath(){return(this.preferences.lastPath||f.dy.lastPath).filter(t=>t.length>0)}set lastFolderPath(t){const a=this.preferences;a.lastPath=t,this.preferences=a}get layoutOptions(){const t=f.dy.layout,a=this.preferences.layout;return a&&0===Object.keys(t).filter(p=>!(0,i.l$)(a,p)).length?a:t}set layoutOptions(t){const a=this.preferences;a.layout=t,this.preferences=a}get uploader(){const t=this.preferences.uploader||f.dy.uploader;return!t.checkImage.active&&Date.now()-t.checkImage.time>6048e5&&(t.checkImage.active=!0,this.uploader=t),(0,i.l$)(t,"showLinkModal")||(t.showLinkModal=!1),t}set uploader(t){const a=this.preferences;a.uploader=t,this.preferences=a}get remote(){return this.preferences.remote}set remote(t){const a=this.preferences;a.remote=t,this.preferences=a}set remoteId(t){const a=this.preferences;a.remote={id:t,advice:{...a.remote?.advice||{disabled:!1}}},this.preferences=a}static#e=I=()=>(this.\u0275fac=function(a){return new(a||e)(s.KVO(y.W),s.KVO(m.v))},this.\u0275prov=s.jDH({token:e,factory:e.\u0275fac,providedIn:"root"}))}return I(),e})()},4857:(A,D,r)=>{r.d(D,{dy:()=>l,gF:()=>f,mn:()=>s,tv:()=>m,uX:()=>y});var i=r(7602);const l={lastPath:[],layout:{asc:!0,orderBy:i.Kk.FILENAME,type:i.om.GRID},uploader:{checkImage:{time:0,active:!0},showLinkModal:!1}},y=/^(?:(?![\t\r\n])[a-zA-Z0-9_\-.\s])*$/,f=/^(?:(?![\t\r\n])[a-zA-Z0-9_\-\s])*$/,m={invalidLength:!1,alreadyUsed:!1,invalidStartOrEnd:!1,invalidCharacter:!1},s=2147483648},6007:(A,D,r)=>{r.d(D,{D:()=>e,Ee:()=>L,GR:()=>o,Jq:()=>_,L6:()=>c,LL:()=>P,PD:()=>S,PL:()=>R,YN:()=>I,ZA:()=>O,a2:()=>f,bj:()=>g,d9:()=>a,qL:()=>s,wu:()=>v});var i=r(467),l=r(7602),y=r(4857);function f(u){return m.apply(this,arguments)}function m(){return m=(0,i.A)(function*(u){return new Promise((d,h)=>{const E=new FileReader;E.onload=function(){var M=(0,i.A)(function*(b){if(b.target&&b.target.result){const F=new Uint8Array(b.target.result),U=yield crypto.subtle.digest("SHA-256",F),C=Array.from(new Uint8Array(U)).map(k=>k.toString(16).padStart(2,"0")).join("");d(C)}else h(new Error("Failed to read file."))});return function(b){return M.apply(this,arguments)}}(),E.onerror=M=>{h(M)},E.readAsArrayBuffer(u)})}),m.apply(this,arguments)}function s(u){let d=u;if(u.indexOf("/")>-1){const b=u.split("/");d=b[b.length-1]}const h=d.replace(/\?.*$/,"").split("."),E=h.length>1?h[h.length-1].toLowerCase():"",M=decodeURIComponent(h.slice(0,-1).join("."));return{ext:E,filename:M,name:E?`${M}.${E}`:""}}function O(u,d={}){const h=s(u),E=Date.now();return{name:h.name,size:0,time:E,accessedInThreshold:null,url:u,ext:h.ext,filename:h.filename,isImage:v(h.ext),embedUrl:`${u}?t=${E}`,type:l.OE.FILE,...d}}function I(u){let d=u;d.endsWith("/")&&(d=d.slice(0,-1));const h=d.split("/");return{name:decodeURIComponent(h[h.length-1])}}function e(u){return{name:I(u).name,url:u,type:l.OE.FOLDER}}function n(u){return t.apply(this,arguments)}function t(){return(t=(0,i.A)(function*(u){const d=new FileReader,h=new Promise(E=>d.addEventListener("load",()=>E(d.result)));return d.readAsDataURL(u),h})).apply(this,arguments)}function a(u){return p.apply(this,arguments)}function p(){return(p=(0,i.A)(function*(u){const d=new DataView(yield u.arrayBuffer());if(2303741511===d.getUint32(0)&&218765834===d.getUint32(4)){if(-1===[4,6].indexOf(d.getUint8(25)))return!1;const E=Object.assign(new Image,{src:yield n(u)});yield new Promise(F=>E.addEventListener("load",()=>F(!0)));const M=Object.assign(document.createElement("canvas"),{width:E.width,height:E.height}).getContext("2d");if(!M)return!1;M.imageSmoothingEnabled=!1,M.drawImage(E,0,0);const b=M?.getImageData(0,0,E.width,E.height);if(b)for(let F=0;F<b.data.length;F+=4)if(b.data[F+3]<255)return!0}return!1})).apply(this,arguments)}function L(u){return T.apply(this,arguments)}function T(){return(T=(0,i.A)(function*(u){const d=Object.assign(new Image,{src:yield n(u)});return yield new Promise(h=>d.addEventListener("load",()=>h(!0))),d})).apply(this,arguments)}function c(u){return u.map(d=>({name:d.name,ext:d.ext,type:l.OE.FILE,url:d.url,embedUrl:d.embedUrl,isImage:d.isImage}))}function v(u,d=[]){return["png","apng","jpeg","jpg","jpe","gif","svg","webp"].includes(u)&&!d.includes(u)}function o(u){return v(u,["gif","svg"])}function _(u,d,h,E=[],M=""){const b={...y.tv},F=u.trim();b.invalidLength=0===F.length;const U=(F+M).replace(/\s{2,}/g," ");return b.alreadyUsed=d!==F&&E.includes(U),b.invalidStartOrEnd=/(^(\s|\.))|((\s|\.)$)/.test(u),b.invalidCharacter=!(h===l.OE.FILE?y.uX.test(u):y.gF.test(u)),b}function g(u,d){return u.join("/")===d.join("/")}function S(u){const d=[],h=[];for(const E of u)E.type===l.OE.FILE?d.push(E):h.push(E);return{[l.OE.FILE]:d,[l.OE.FOLDER]:h}}function R(u,d){return d.find(h=>-1!==h.ext.indexOf(u))}function P(u,d,h){return d=d||s(u.name),{file:{name:u.name,size:u.size,time:0,accessedInThreshold:null,url:"",ext:d.ext,filename:d.filename,isImage:v(d.ext),embedUrl:"",type:l.OE.FILE},metadata:h,progress:0,completed:!1}}},6485:(A,D,r)=>{r.d(D,{B:()=>L});var i=r(467),l=r(2998),y=r(4843),f=r(7602),m=r(6007),s=r(959),O=r(130),I=r(1946),e=r(3101),n=r(870),t=r(9018),a=r(2615),p=r(9330);let L=(()=>{var T;class c{constructor(o,_,g,S,R,P){this.graphqlService=o,this.uploadCacheService=_,this.uploadPreferencesService=g,this.http=S,this.uploadEndpointsService=R,this.uploadTokensService=P}get cache(){return this.uploadCacheService}get preferences(){return this.uploadPreferencesService}setGqlIdHeader(){this.graphqlService.safeSetGlobalHeader(l.vk.UUID,(0,e.A)())}removeGqlIdHeader(){this.graphqlService.removeGlobalHeader(l.vk.UUID)}getGqlIdHeader(){return this.graphqlService.getGlobalHeader(l.vk.UUID)||""}getFileLimits(){var o=this;return(0,i.A)(function*(){const _=o.cache.getFileLimits();if(_)return _;const g=yield o.uploadTokensService.generateFileLimitsToken(),R=(yield o.sendRequest(g)).map(P=>({ext:P.extension,maxSize:P.size}));return o.cache.setFileLimits(R),R})()}getUserStorage(){var o=this;return(0,i.A)(function*(_=!1){return _?yield o.requestUserStorage(!0):o.cache.getUserStorage()||(yield o.requestUserStorage())}).apply(this,arguments)}flushUserStorage(){this.cache.deleteUserStorage()}requestUserStorage(){var o=this;return(0,i.A)(function*(_=!1){const g=o.uploadTokensService.userStorageToken||(yield o.uploadTokensService.generateUserStorageToken(_||void 0)),S=yield o.sendRequest(g).catch(P=>{});if(!S)return;const R={used:S.used,max:S.limit,exceeded:S.exceeded};return o.cache.setUserStorage(R),R}).apply(this,arguments)}getFileList(o){var _=this;return(0,i.A)(function*(){const g=_.uploadCacheService.getItem(o);if(g)return g;const S=_.uploadTokensService.fileListToken||(yield _.uploadTokensService.generateFileListToken(o)),R=yield _.sendRequest(S),u={files:R.files.map(d=>{const h=(0,m.qL)(d.url);return{...d,time:1e3*d.time,filename:h.filename,ext:h.ext,isImage:(0,m.wu)(h.ext),embedUrl:`${d.url}?t=${d.time}`,type:f.OE.FILE}}),folders:R.folders.map(d=>({...d,type:f.OE.FOLDER}))};return _.uploadCacheService.setItem(o,u),u})()}createDirectory(o){var _=this;return(0,i.A)(function*(){const g=yield _.uploadTokensService.generateCreateDirectoryToken(o);return yield _.sendRequest(g)})()}moveRenameEntity(o,_,g,S){var R=this;return(0,i.A)(function*(){S||(S=g);const P=yield R.uploadTokensService.generateMoveRenameEntityToken(o,_,g,S),u=yield R.sendRequest(P);return{...u,time:1e3*u.time}})()}deleteEntity(o,_){var g=this;return(0,i.A)(function*(){const S=yield g.uploadTokensService.generateDeleteEntityToken(o,_);return yield g.sendRequest(S),!0})()}sendRequest(o){var _=this;return(0,i.A)(function*(){return(yield(0,y._)(_.http.post(_.uploadEndpointsService.requiredActiveRemote.address,JSON.stringify({payload:o}),{headers:{"Content-Type":"application/json"}}))).success})()}subscribeForChanges(o){var _=this;return(0,i.A)(function*(){return yield _.graphqlService.subscribe({query:s.CZ},g=>{if(!g.data?.uploadEntities)return;const S=JSON.parse(g.data.uploadEntities.eventMessage);!S.payload.customHeaders||!(0,l.l$)(S.payload.customHeaders,l.vk.UUID)||S.payload.customHeaders[l.vk.UUID]===_.getGqlIdHeader()||o({type:g.data.uploadEntities.eventType,message:S})})})()}static#e=T=()=>(this.\u0275fac=function(_){return new(_||c)(a.KVO(l.Pp),a.KVO(O.J),a.KVO(I.d),a.KVO(p.Qq),a.KVO(n.D),a.KVO(t.h))},this.\u0275prov=a.jDH({token:c,factory:c.\u0275fac,providedIn:"root"}))}return T(),c})()},7602:(A,D,r)=>{r.d(D,{Kk:()=>y,OE:()=>l,SP:()=>i,kO:()=>m,om:()=>f});var i=function(s){return s.FILE_SHOW_LINKS="fileLinks",s.FILE_EDIT="fileEdit",s.DELETE="delete",s.RENAME="rename",s.MOVE="move",s}(i||{}),l=function(s){return s.FILE="file",s.FOLDER="folder",s}(l||{}),y=function(s){return s.FILENAME="filename",s.SIZE="size",s.TIME="time",s.EXTENSION="ext",s}(y||{}),f=function(s){return s.GRID="grid",s.LIST="list",s}(f||{}),m=function(s){return s.W_768_I_1="(max-width: 767.98px)",s.W_933_I_2="(min-width: 768px) and (max-width: 933.98px)",s.W_960_I_3="(min-width: 934px) and (max-width: 959.98px)",s.W_1226_I_2="(min-width: 960px) and (max-width: 1225.98px)",s.W_1540_I_3="(min-width: 1226px) and (max-width: 1539.98px)",s.W_1854_I_4="(min-width: 1540px) and (max-width: 1853.98px)",s.W_2168_I_5="(min-width: 1854px) and (max-width: 2167.98px)",s.W_2482_I_6="(min-width: 2168px) and (max-width: 2481.98px)",s.W_2796_I_7="(min-width: 2482px) and (max-width: 2795.98px)",s.W_3110_I_8="(min-width: 2796px) and (max-width: 3109.98px)",s.W_3424_I_9="(min-width: 3110px) and (max-width: 3423.98px)",s.W_3738_I_10="(min-width: 3424px)",s}(m||{})},7696:(A,D,r)=>{r.d(D,{j:()=>i});var i=function(l){return l.OWNED="owned",l.LINKED="linked",l}(i||{})},8289:(A,D,r)=>{r.d(D,{L:()=>y});var i=r(9424),l=r(3664);let y=(()=>{var f;class m{transform(O,I=2){return(0,i.z)(O,I)}static#e=f=()=>(this.\u0275fac=function(I){return new(I||m)},this.\u0275pipe=l.EJ8({name:"formatBytes",type:m,pure:!0,standalone:!1}))}return f(),m})()},9018:(A,D,r)=>{r.d(D,{h:()=>m});var i=r(467),l=r(2615),y=r(2998),f=r(959);let m=(()=>{var s;class O{constructor(){this.graphqlService=(0,l.WQX)(y.Pp)}set userStorageToken(e){this.userStorageCache=e}get userStorageToken(){const e=this.userStorageCache;return this.userStorageCache=void 0,e}set fileListToken(e){this.fileListCache=e}get fileListToken(){const e=this.fileListCache;return this.fileListCache=void 0,e}generateFileListToken(e){var n=this;return(0,i.A)(function*(){return(yield n.graphqlService.query({query:f.yf,variables:{target:e.join("/")}})).data.uploadEntitiesListToken})()}generateHostToken(e,n,t){var a=this;return(0,i.A)(function*(){return(yield a.graphqlService.query({query:f._Y,variables:{allowReplace:t,target:(e.length?`${e.join("/")}/`:"")+n}})).data?.uploadEntitiesHostToken||void 0})()}generateCreateDirectoryToken(e){var n=this;return(0,i.A)(function*(){return(yield n.graphqlService.query({query:f.BC,variables:{target:e.join("/")}})).data.uploadEntitiesCreateDirectoryToken})()}generateMoveRenameEntityToken(e,n,t,a){var p=this;return(0,i.A)(function*(){return(yield p.graphqlService.query({query:f.F8,variables:{source:(e.length?`${e.join("/")}/`:"")+t,target:(n.length?`${n.join("/")}/`:"")+a}})).data.uploadEntitiesMoveToken})()}generateDeleteEntityToken(e,n){var t=this;return(0,i.A)(function*(){return(yield t.graphqlService.query({query:f.TE,variables:{target:(e.length?`${e.join("/")}/`:"")+n}})).data.uploadEntitiesDeleteToken})()}generateUserStorageToken(e){var n=this;return(0,i.A)(function*(){return(yield n.graphqlService.query({query:f.Ny,variables:{allowCompute:e}})).data.uploadEntitiesSizeToken})()}generateFileLimitsToken(){var e=this;return(0,i.A)(function*(){return(yield e.graphqlService.query({query:f._9})).data.uploadEntitiesLimitsToken})()}static#e=s=()=>(this.\u0275fac=function(n){return new(n||O)},this.\u0275prov=l.jDH({token:O,factory:O.\u0275fac,providedIn:"root"}))}return s(),O})()},9424:(A,D,r)=>{r.d(D,{z:()=>l});var i=r(5041);function l(y,f=2){if(!+y)return"0 Bytes";let m=!1;y<0&&(m=!0,y=Math.abs(y));const O=f<0?0:f,e=Math.floor(Math.log(y)/Math.log(1024));return`${m?"-":""}${(0,i.A)(parseFloat((y/Math.pow(1024,e)).toFixed(O)))} ${["Bytes","KB","MB","GB","TB","PB","EB","ZB","YB"][e]}`}}}]);